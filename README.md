![alt text](logo.png)

# Voltage Anomaly Detection SmartApp

This repository contains a base application for detecting temperature anomalies and recommending motor speed adjustments using the Kelvin platform.

## Overview

This Kelvin SmartApp monitors incoming asset data streams for `motor_temperature` and `motor_speed`. When the motor temperature exceeds a configurable threshold, the app recommends reducing the motor speed by 10% and provides operator guidance and visual evidence. The recommendation can be auto-accepted or require operator approval, depending on the `kelvin_closed_loop` parameter.

## Features

- Streams and processes asset data in real time.
- Detects when motor temperature exceeds a per-asset threshold.
- Issues a recommendation to reduce motor speed by 10% if an over-temperature event is detected.
- Attaches markdown guidance and an infographic as evidence to each recommendation.
- Supports both open-loop (operator approval) and closed-loop (automatic execution) modes via app parameters.

## Configuration

### App Parameters

Parameters are defined in [app.yaml](app.yaml) and [ui_schemas/parameters.json](ui_schemas/parameters.json):

- **kelvin_closed_loop** (`boolean`): If `true`, recommendations are auto-accepted and executed; if `false`, operator approval is required.
- **temperature_max_threshold** (`number`): The maximum allowed motor temperature before a recommendation is triggered (default: 59).

You can adjust these parameters per asset in the Kelvin UI.

### Data Streams

- **Inputs**:  
  - `motor_temperature` (`number`)
  - `motor_speed` (`number`)
- **Outputs**:  
  - `motor_speed_set_point` (`number`, as a control change)

## How It Works

1. The app listens for incoming `motor_temperature` and `motor_speed` messages.
2. It tracks the latest motor speed for each asset.
3. If a temperature reading exceeds the configured threshold, the app:
    - Calculates a new speed setpoint (10% reduction).
    - Builds a recommendation with markdown instructions and an infographic.
    - Publishes the recommendation for operator review or auto-execution, based on the `kelvin_closed_loop` parameter.

## Running the App

To run the app locally:

```sh
python main.py
```

Or build and run in Docker:

```sh
docker build -t kelvin-app .
docker run --rm kelvin-app
```

## Deployment

To upload your application to Kelvin, first log in to your Kelvin instance:

```sh
kelvin auth login <instance>.kelvin.ai
```

Then upload your app:

```sh
kelvin app upload
```

## File Structure

- [main.py](main.py): Main application logic.
- [app.yaml](app.yaml): App configuration, data streams, parameters.
- [ui_schemas/parameters.json](ui_schemas/parameters.json): UI schema for app parameters.
- [requirements.txt](requirements.txt): Python dependencies.

## Documentation

- [Kelvin SmartApp Documentation](https://docs.kelvin.ai/)
- See `.github/` for detailed guides on parameters, control changes, recommendations, and data streams.

---
*Generated by Kelvin SmartApp Copilot*
